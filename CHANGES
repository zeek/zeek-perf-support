0.10.0 | 2026-02-27 16:56:13 +0100

  * Use std::current_exception() and std::rethrow_exception() (Arne Welzel, Corelight)

    ...and add a test case for ZAM when.

    Long story: @Mohan-Dhawan was using an older version of this plugin that
    didn't yet have the try-catch logic added for 0.9.0 and observed an
    unexpected ZAMDelayedCallException being thrown in his deployment.

    After adding a test case, not being able to reproduce, a small rabbit
    hole of different RTTI information being used in the plugin vs Zeek
    main, we finally figured out that he was actually using version 0.8.1
    that didn't have any of the try-catch logic.

    Anyhow, during the investigation, the std::current_exception() and
    std::rethrow_exception() functions came up and they seem the better
    fit rather than rethrowing a custom subclass of InterpreterException.
    For some reason, the ZAMDelayedCallException isn't ever caught anywhere
    in Zeek, but if it were, the RethrownInterpreterException used in this
    plugin would have subtly broken something. So better safe than sorry.

0.9.1 | 2025-08-08 16:06:10 +0200

  * GH-3: Trampoline: Add extra underscore on OSX (Arne Welzel, Corelight)

0.9.0 | 2025-08-07 17:06:32 +0200

  * print-trampoline: Add -fno-optimize-sibling-calls, too (Arne Welzel, Corelight)

  * Trampoline: Fix aarch64 (Arne Welzel, Corelight)

    This is just using the assembly code produced via `print make-trampoline`
    without quite understanding how aarch64 works.

  * Add instructions for producing the trampoline assembly code (Arne Welzel, Corelight)

  * Add Github CI workflow for PRs using Docker on x86 and arm runners (Arne Welzel, Corelight)

  * Using a derivation to no longer require a change to Zeek. (cccs-jsjm)

    Indeed, InterpreterException's constructor is protected, so we may
    create a new instance if we introduce a new derived class. All catch
    statements in Zeek appear to catch by reference, so there should be no
    issue if a RethrownInterpreterException is caught as an
    InterpreterException.

  * Fixing failure to propagate exceptions across the trampoline. (cccs-jsjm)

    The issue observed is that the program aborts because the C++ runtime
    function __cxa_throw cannot find an exception handler. Runtime errors
    in the Zeek scripting language are propagated by exceptions, notably
    zeek::InterpreterException. When compiling with exception support, a C++
    compiler also generates the contents for the .eh_frame section. This
    section supports the exception mechanism by permitting the discovery
    of the appropriate catch statement, among other things.

    In theory, it should be possible to dynamically register the data necessary
    to unwind the stack over the trampoline, but doing so in a robust and portable
    manner is not trivial. I believe this would require calling functions
    from the C++ runtime library. Furthermore, the data that would need to be
    registered would depend on the processor architecture. Using a library that
    provides support for JIT compilation and loading might help solve this problem
    for the general case, but it doesn't seem to be worth using a library for the
    particular case here.

    The approach adopted by this commit is that InterpreterException is
    caught and the rethrown to avoid unwinding across the trampoline.
    This is not an universal solution in the sense that only known exception
    classes are handled correctly. Here, only InterpeterException is handled.

    The changes in this commit requires that zeek::SuspededException is a
    friend class to zeek::InterpreterException, which is a small change in
    upstream Zeek. In addition the SuspededException class could be moved to
    Zeek, because declaring a friend that is never defined is weird.

    I tested this with gcc_15.0.50.20240403-git and Zeek somewhere near version 7.2.2.
    I don't have any way of testing the AARCH version.

  * Adding unit test that does not pass (yet). (cccs-jsjm)

  * Avoing memory pages that are simultaneously writable and executable. (cccs-jsjm)

  * Adding an endbr64 to make it work with Intel CET. (cccs-jsjm)

  * The trampoline no longer omits the frame pointer. (cccs-jsjm)

    This seems like a reasonable improvement to get more accurate reports
    from perf.

0.8.1 | 2025-07-14 12:53:28 -0700

0.8.0-2 | 2025-07-14 12:53:18 -0700

  * Fix ZEEK_VERSION_NUMBER constant name (Tim Wojtulewicz, Corelight)

0.8.0 | 2025-07-14 09:39:14 +0200

0.7.0 | 2025-07-14 09:38:53 +0200

  * Fix usage of Location class after recent upstream changes (Tim Wojtulewicz, Corelight)

0.6.0 | 2025-04-11 09:09:21 +0200

  * ARM support: Remove error pragma from trampoline code (Jeff Lucovsky)

    Proper ARM operation validated on recent pi system.

0.5.0 | 2025-03-31 12:52:42 +0200

  * Use custom type as fclose replacement (Arne Welzel, Corelight)

  * CMakeLists: Switch to zeek_plugin_begin() (Arne Welzel, Corelight)

  * CMakeLists: Use source file properties rather than target properties (Arne Welzel, Corelight)

0.4.0 | 2024-11-21 14:50:21 +0100

  * tests: Add ZAM smoke test (Arne Welzel, Corelight)

    Ensure it is not obviously crashing.

  * Avoid endless type recursion (Arne Welzel, Corelight)

    The ZBody statement's Traverse method ends up traversing types, so we
    need to protect from endless recursion.

  * Use InitPreExecution() when on Zeek 7.1 or later (Arne Welzel, Corelight)

    This allows profiling also when running with ZAM enabled, but only
    with Zeek 7.1 or later.

0.3.0 | 2024-11-19 10:45:19 +0100

  * Bump version to 0.3.0 (Arne Welzel, Corelight)

  * git: Ignore clangd .cache dir (Arne Welzel, Corelight)

  * ci: Bump to Zeek 7.0 (Arne Welzel, Corelight)

  * cmake: Use new zeek_add_plugin() (Arne Welzel, Corelight)

  * Use Func::GetName() when available (Arne Welzel, Corelight)

  * Use STMT_EXTERN when available (Arne Welzel, Corelight)

0.2.0 | 2024-02-07 11:41:46 +0100

  * Starting CHANGES. (Arne Welzel, Corelight)
